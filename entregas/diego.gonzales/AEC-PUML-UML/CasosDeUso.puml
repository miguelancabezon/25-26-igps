@startuml parte1
title Sistema de Gestión de Biblioteca - Diagrama de Casos de Uso
left to right direction
skinparam packageStyle rectangle
skinparam actorStyle awesome

' Definición de Actores
actor "Estudiante" as Estudiante
actor "Profesor" as Profesor
actor "Bibliotecario" as Bibliotecario
actor "Sistema" as Sistema

' Relación de herencia para simplificar (Profesor tiene mismos permisos básicos que Estudiante)
Estudiante <|-- Profesor

package "Búsqueda y consulta" {
    usecase "Buscar en catálogo" as UC_Buscar
    usecase "Ver historial de préstamos" as UC_Historial
    usecase "Consultar estado de libro" as UC_EstadoLibro
}

package "Gestión de Préstamos" {
    usecase "Solicitar préstamo" as UC_Solicitar
    usecase "Renovar préstamo" as UC_Renovar
    usecase "Devolver libro" as UC_Devolver
    usecase "Registrar préstamo manual" as UC_Manual
    usecase "Procesar devolución" as UC_ProcesarDev
}

package "Gestión de Reservas" {
    usecase "Hacer reserva" as UC_Reservar
    usecase "Cancelar reserva" as UC_CancelarRes
    usecase "Notificar disponibilidad" as UC_Notificar
}

package "Penalizaciones" {
    usecase "Calcular multa" as UC_CalcMulta
    usecase "Pagar multa online" as UC_Pagar
    usecase "Aplicar penalización" as UC_AplicarPenal
}

package "Reportes" {
    usecase "Generar reporte de préstamos" as UC_RepPrestamos
    usecase "Generar reporte de multas" as UC_RepMultas
}

' Relaciones Estudiante/Profesor
Estudiante --> UC_Buscar
Estudiante --> UC_Historial
Estudiante --> UC_EstadoLibro
Estudiante --> UC_Solicitar
Estudiante --> UC_Renovar
Estudiante --> UC_Devolver
Estudiante --> UC_Reservar
Estudiante --> UC_CancelarRes
Estudiante --> UC_Pagar

' Relaciones Bibliotecario
Bibliotecario --> UC_Buscar
Bibliotecario --> UC_EstadoLibro
Bibliotecario --> UC_Manual
Bibliotecario --> UC_ProcesarDev
Bibliotecario --> UC_AplicarPenal
Bibliotecario --> UC_RepPrestamos
Bibliotecario --> UC_RepMultas

' Relaciones del Sistema (Automáticas)
UC_Notificar <-- Sistema : Envía email
UC_CalcMulta <-- Sistema : Automático al vencer
UC_Solicitar ..> UC_Notificar : include
UC_ProcesarDev ..> UC_CalcMulta : include

note right of UC_Renovar
  Regla: Máximo 2 renovaciones
  si no hay reservas pendientes.
end note

note right of UC_Reservar
  Solo si el libro está prestado.
end note

@enduml